<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ryuto's StepMania Charts</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,typography"></script>
		<script src="https://unpkg.com/unlazy@0.11.3/dist/unlazy.with-hashing.iife.js" defer init></script>
    <script src="https://unpkg.com/@heroicons/v1/outline/"></script>
		<script type="text/javascript">
			window.tailwind.config = {
        darkMode: 'class',
				theme: {
					extend: {
						colors: {
							border: 'hsl(var(--border))',
							input: 'hsl(var(--input))',
							ring: 'hsl(var(--ring))',
							background: 'hsl(var(--background))',
							foreground: 'hsl(var(--foreground))',
							primary: {
								DEFAULT: 'hsl(var(--primary))',
								foreground: 'hsl(var(--primary-foreground))'
							},
							secondary: {
								DEFAULT: 'hsl(var(--secondary))',
								foreground: 'hsl(var(--secondary-foreground))'
							},
							destructive: {
								DEFAULT: 'hsl(var(--destructive))',
								foreground: 'hsl(var(--destructive-foreground))'
							},
							muted: {
								DEFAULT: 'hsl(var(--muted))',
								foreground: 'hsl(var(--muted-foreground))'
							},
							accent: {
								DEFAULT: 'hsl(var(--accent))',
								foreground: 'hsl(var(--accent-foreground))'
							},
							popover: {
								DEFAULT: 'hsl(var(--popover))',
								foreground: 'hsl(var(--popover-foreground))'
							},
							card: {
								DEFAULT: 'hsl(var(--card))',
								foreground: 'hsl(var(--card-foreground))'
							},
						},
            animation: {
              'gradient': 'gradient 8s linear infinite',
            },
            keyframes: {
              gradient: {
                '0%, 100%': {
                  'background-size': '200% 200%',
                  'background-position': 'left center'
                },
                '50%': {
                  'background-size': '200% 200%',
                  'background-position': 'right center'
                }
              }
            }
					}
				}
			}
		</script>
		<style type="text/tailwindcss">
			@layer base {
				:root {
          --background: 210 40% 98%;
--foreground: 222.2 84% 4.9%;
--card: 0 0% 100%;
--card-foreground: 222.2 84% 4.9%;
--popover: 0 0% 100%;
--popover-foreground: 222.2 84% 4.9%;
--primary: 221.2 83.2% 53.3%;
--primary-foreground: 210 40% 98%;
--secondary: 210 40% 96.1%;
--secondary-foreground: 222.2 47.4% 11.2%;
--muted: 210 40% 96.1%;
--muted-foreground: 215.4 16.3% 46.9%;
--accent: 210 40% 96.1%;
--accent-foreground: 222.2 47.4% 11.2%;
--destructive: 0 84.2% 60.2%;
--destructive-foreground: 210 40% 98%;
--border: 214.3 31.8% 91.4%;
--input: 214.3 31.8% 91.4%;
--ring: 221.2 83.2% 53.3%;
				}
				.dark {
					--background: 222.2 84% 4.9%;
--foreground: 210 40% 98%;
          --card: 217.2 32.6% 17.5%;
--card-foreground: 210 40% 98%;
--popover: 222.2 84% 4.9%;
--popover-foreground: 210 40% 98%;
--primary: 217.2 91.2% 59.8%;
--primary-foreground: 222.2 47.4% 11.2%;
--secondary: 217.2 32.6% 17.5%;
--secondary-foreground: 210 40% 98%;
--muted: 217.2 32.6% 17.5%;
--muted-foreground: 215 20.2% 65.1%;
--accent: 217.2 32.6% 17.5%;
--accent-foreground: 210 40% 98%;
--destructive: 0 62.8% 30.6%;
--destructive-foreground: 210 40% 98%;
--border: 217.2 32.6% 17.5%;
--input: 217.2 32.6% 17.5%;
--ring: 224.3 76.3% 48%;
				}
			}

      .difficulty-badge {
        @apply rounded-full py-1.5 px-3 text-xs font-medium flex items-center gap-2 transition-all duration-300 hover:scale-105;
      }
      
      .difficulty-badge span {
        @apply rounded-full py-0.5 px-2 text-xs font-bold;
      }
		</style>
  </head>
  <body class="bg-background text-foreground min-h-screen transition-colors duration-300">
    <div class="relative">
      <!-- Dark mode toggle -->
      <button 
        onclick="document.documentElement.classList.toggle('dark')"
        class="fixed top-4 right-4 z-50 p-2 rounded-full bg-card text-card-foreground hover:bg-accent transition-colors duration-300">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 dark:hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
        </svg>
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 hidden dark:block" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />
        </svg>
      </button>

      <!-- Header -->
      <header class="relative overflow-hidden bg-gradient-to-r from-primary to-purple-600 text-primary-foreground">
        <div class="max-w-7xl mx-auto py-8 px-4 sm:px-6 lg:px-8">
          <div class="text-center">
            <h1 class="text-4xl font-extrabold tracking-tight sm:text-5xl md:text-6xl">
              Ryuto's StepMania Charts
            </h1>
            <p class="mt-3 max-w-md mx-auto text-base sm:text-lg md:mt-5 md:text-xl md:max-w-3xl">
              Click on a song image to download the chart!
            </p>
          </div>
        </div>
        <div class="absolute bottom-0 w-full h-16 bg-gradient-to-t from-background to-transparent"></div>
    </header>

      <!-- Main Content -->
      <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
        <!-- Controls Panel -->
        <div class="mb-8 bg-card rounded-xl p-4 shadow-lg">
          <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <!-- Search -->
            <div class="relative">
              <input 
                type="text" 
                id="searchInput"
                placeholder="Search songs or artists..."
                class="w-full px-4 py-2 rounded-lg bg-background border border-input focus:border-primary focus:ring-1 focus:ring-primary outline-none transition-colors"
                oninput="filterAndSortSongs()"
              >
              <svg class="absolute right-3 top-2.5 h-5 w-5 text-muted-foreground" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
              </svg>
            </div>

            <!-- Difficulty Filter -->
            <div class="flex items-center space-x-2">
              <label class="text-sm font-medium">Difficulty Range:</label>
              <select 
                id="minDifficulty" 
                class="px-2 py-1.5 rounded bg-background border border-input focus:border-primary focus:ring-1 focus:ring-primary outline-none transition-colors"
                onchange="filterAndSortSongs()"
              >
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
              </select>
              <span>to</span>
              <select 
                id="maxDifficulty" 
                class="px-2 py-1.5 rounded bg-background border border-input focus:border-primary focus:ring-1 focus:ring-primary outline-none transition-colors"
                onchange="filterAndSortSongs()"
              >
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5" selected>5</option>
              </select>
                </div>

            <!-- Sort Options -->
            <div class="flex items-center space-x-2">
              <label class="text-sm font-medium">Sort by:</label>
              <select 
                id="sortOption" 
                class="flex-1 px-2 py-1.5 rounded bg-background border border-input focus:border-primary focus:ring-1 focus:ring-primary outline-none transition-colors"
                onchange="filterAndSortSongs()"
              >
                <option value="title">Title</option>
                <option value="artist">Artist</option>
                <option value="duration">Duration</option>
                <option value="difficulty">Max Difficulty</option>
              </select>
              <button 
                id="sortDirection" 
                onclick="toggleSortDirection()"
                class="p-1.5 rounded bg-background border border-input hover:bg-accent transition-colors"
              >
                <svg id="sortAscIcon" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4h13M3 8h9M3 12h5M3 16h9M3 20h13" />
                </svg>
                <svg id="sortDescIcon" class="h-5 w-5 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4h5M3 8h9M3 12h13M3 16h9M3 20h5" />
                </svg>
              </button>
            </div>
          </div>
        </div>

        <!-- Results Count -->
        <div class="mb-4 text-muted-foreground">
          <p id="resultsCount">Showing all songs</p>
        </div>

        <!-- Songs Grid -->
        <div id="songs-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8">
          <!-- Songs will be dynamically loaded here -->
        </div>
    
        <!-- No Results Message -->
        <div id="noResults" class="hidden text-center py-12">
          <p class="text-xl text-muted-foreground">No songs match your search criteria</p>
        </div>
    </main>
</div>

    <footer class="bg-card mt-12">
      <div class="max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8">
        <p class="text-center text-muted-foreground text-sm">
          Made with ♥ by Ryuto
        </p>
      </div>
    </footer>

    <script>
      // Will store all loaded songs
      let songsData = [];

      // Function to load a single song file
      async function loadSongFile(filename) {
        const response = await fetch(`songs/${filename}`);
        const songData = await response.json();
        return songData;
      }

      // Function to load all songs
      async function loadSongs() {
        try {
          // First load the index file
          const indexResponse = await fetch('songs/index.json');
          const indexData = await indexResponse.json();
          
          // Load all song files in parallel
          const songPromises = indexData.songFiles.map(filename => loadSongFile(filename));
          songsData = await Promise.all(songPromises);
          
          // Initialize the display
          filterAndSortSongs();
        } catch (error) {
          console.error('Error loading songs:', error);
          const songsGrid = document.getElementById('songs-grid');
          songsGrid.innerHTML = `
            <div class="col-span-full text-center text-muted-foreground">
              <p class="text-xl mb-2">Error loading songs</p>
              <p class="text-sm">Could not load the songs data. Please try refreshing the page.</p>
              <p class="text-xs mt-4 text-destructive">${error.message}</p>
            </div>
          `;
        }
      }

      // Helper function to get max difficulty of a song
      function getMaxDifficulty(song) {
        const difficulties = [...Object.values(song.difficulties.singles), ...Object.values(song.difficulties.doubles)];
        const levels = difficulties
          .map(diff => diff.level)
          .filter(level => level !== '-')
          .map(level => parseInt(level));
        return Math.max(...levels);
      }

      // Helper function to parse duration string to seconds
      function durationToSeconds(duration) {
        const [minutes, seconds] = duration.split(':').map(Number);
        return minutes * 60 + seconds;
      }

      // Sorting and filtering state
      let sortAscending = true;

      // Function to toggle sort direction
      function toggleSortDirection() {
        sortAscending = !sortAscending;
        document.getElementById('sortAscIcon').classList.toggle('hidden');
        document.getElementById('sortDescIcon').classList.toggle('hidden');
        filterAndSortSongs();
      }

      // Function to filter and sort songs
      function filterAndSortSongs() {
        const searchTerm = document.getElementById('searchInput').value.toLowerCase();
        const minDifficulty = parseInt(document.getElementById('minDifficulty').value);
        const maxDifficulty = parseInt(document.getElementById('maxDifficulty').value);
        const sortOption = document.getElementById('sortOption').value;

        // Filter songs
        let filteredSongs = songsData.filter(song => {
          const matchesSearch = song.title.toLowerCase().includes(searchTerm) || 
                              song.artist.toLowerCase().includes(searchTerm);
          const maxDiff = getMaxDifficulty(song);
          const matchesDifficulty = maxDiff >= minDifficulty && maxDiff <= maxDifficulty;
          return matchesSearch && matchesDifficulty;
        });

        // Sort songs
        filteredSongs.sort((a, b) => {
          let comparison = 0;
          switch (sortOption) {
            case 'title':
              comparison = a.title.localeCompare(b.title);
              break;
            case 'artist':
              comparison = a.artist.localeCompare(b.artist);
              break;
            case 'duration':
              comparison = durationToSeconds(a.duration) - durationToSeconds(b.duration);
              break;
            case 'difficulty':
              comparison = getMaxDifficulty(a) - getMaxDifficulty(b);
              break;
          }
          return sortAscending ? comparison : -comparison;
        });

        // Update the results count
        const resultsCount = document.getElementById('resultsCount');
        resultsCount.textContent = `Showing ${filteredSongs.length} of ${songsData.length} songs`;

        // Show/hide no results message
        const noResults = document.getElementById('noResults');
        noResults.classList.toggle('hidden', filteredSongs.length > 0);

        // Update the grid
        const songsGrid = document.getElementById('songs-grid');
        songsGrid.innerHTML = '';
        filteredSongs.forEach(songData => {
          songsGrid.appendChild(createSongCard(songData));
        });
      }

      // Function to create a song card from song data
      function createSongCard(songData) {
        const difficultyColors = {
          novice: 'purple',
          easy: 'green',
          medium: 'yellow',
          hard: 'red',
          expert: 'blue',
          edit: 'gray'
        };

        const difficultyLabels = {
          novice: 'Novice',
          easy: 'Easy',
          medium: 'Medium',
          hard: 'Hard',
          expert: 'Expert',
          edit: 'Edit'
        };

        function createDifficultyBadges(difficulties) {
          return Object.entries(difficulties)
            .map(([key, data]) => `
              <a href="${data.chart_path}" class="difficulty-badge bg-${difficultyColors[key]}-500 text-white hover:bg-${difficultyColors[key]}-600">
                ${difficultyLabels[key]} <span class="bg-${difficultyColors[key]}-600/50">${data.level}</span>
              </a>
            `).join('');
        }

        const card = document.createElement('div');
        card.className = 'song-card group bg-card text-card-foreground rounded-xl overflow-hidden shadow-lg hover:shadow-2xl transition-all duration-300 transform hover:-translate-y-1';
        card.innerHTML = `
          <a href="${songData.download_path}" class="block relative overflow-hidden">
            <div class="absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex items-center justify-center">
              <span class="text-white font-medium">Download Chart</span>
            </div>
            <img src="${songData.image_path}" alt="${songData.title} Artwork" class="w-full h-56 object-cover transform group-hover:scale-105 transition-transform duration-300">
          </a>
          
          <div class="p-6">
            <h2 class="text-2xl font-bold mb-2">${songData.title}</h2>
            <a href="${songData.artist_url}" class="inline-block hover:text-primary transition-colors duration-200">
              <p class="text-muted-foreground mb-2">${songData.artist}</p>
            </a>
            <p class="text-muted-foreground mb-4">${songData.duration}</p>
            
            <!-- Play Mode Toggle -->
            <div class="flex items-center justify-between mb-4 bg-accent/30 rounded-lg p-2">
              <button 
                onclick="this.closest('.song-card').querySelector('.singles-grid').classList.remove('hidden');
                        this.closest('.song-card').querySelector('.doubles-grid').classList.add('hidden');
                        this.classList.add('bg-primary', 'text-primary-foreground');
                        this.nextElementSibling.classList.remove('bg-primary', 'text-primary-foreground')"
                class="flex-1 py-1 px-3 rounded-md text-sm font-medium transition-colors duration-200 bg-primary text-primary-foreground">
                Singles
              </button>
              <button 
                onclick="this.closest('.song-card').querySelector('.doubles-grid').classList.remove('hidden');
                        this.closest('.song-card').querySelector('.singles-grid').classList.add('hidden');
                        this.classList.add('bg-primary', 'text-primary-foreground');
                        this.previousElementSibling.classList.remove('bg-primary', 'text-primary-foreground')"
                class="flex-1 py-1 px-3 rounded-md text-sm font-medium transition-colors duration-200 ml-2">
                Doubles
              </button>
            </div>

            <!-- Singles Difficulty Grid -->
            <div class="singles-grid grid grid-cols-2 gap-2">
              ${createDifficultyBadges(songData.difficulties.singles)}
            </div>

            <!-- Doubles Difficulty Grid -->
            <div class="doubles-grid hidden grid grid-cols-2 gap-2">
              ${createDifficultyBadges(songData.difficulties.doubles)}
            </div>
          </div>
        `;
        return card;
      }

      // Load songs when the page loads
      document.addEventListener('DOMContentLoaded', loadSongs);
    </script>
  </body>
</html>